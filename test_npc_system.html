<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPC System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .npc-dialogue-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .npc-character {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
        }
        .npc-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 4px solid #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .dialogue-box {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            border-left: 4px solid #667eea;
        }
        .dialogue-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #2d3436;
            margin-bottom: 1.5rem;
            min-height: 3rem;
        }
        .dialogue-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        .dialogue-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .test-controls {
            margin-bottom: 20px;
        }
        .test-controls button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>NPC System Test</h1>
        
        <div class="test-controls">
            <button onclick="testNPC('alex_ceo')">Test Alex (CEO)</button>
            <button onclick="testNPC('sarah_analyst')">Test Sarah (Analyst)</button>
            <button onclick="testNPC('mike_security')">Test Mike (Security)</button>
            <button onclick="testNPC('jenny_developer')">Test Jenny (Developer)</button>
        </div>
        
        <div class="npc-dialogue-area" style="display: none;">
            <div class="npc-character">
                <div id="current-npc-avatar" class="npc-avatar-large">üëî</div>
                <div class="npc-status">
                    <h3 id="current-npc-name">NPC Name</h3>
                    <p id="current-npc-title">NPC Title</p>
                </div>
            </div>
            
            <div class="dialogue-box">
                <div id="dialogue-text" class="dialogue-text">
                    ÎåÄÌôî ÎÇ¥Ïö©Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§...
                </div>
                <div class="dialogue-actions">
                    <button id="continue-dialogue-btn" class="dialogue-btn">Í≥ÑÏÜç</button>
                    <button id="skip-dialogue-btn" class="dialogue-btn" style="display: none;">Í±¥ÎÑàÎõ∞Í∏∞</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock GameManager for testing
        class MockGameManager {
            constructor() {
                this.apiBaseUrl = 'http://localhost:3000/dev';
                this.currentSession = { id: 'test_session' };
            }
            
            async loadQuestion() {
                console.log('Mock: Loading question...');
                // Simulate question loading
                setTimeout(() => {
                    document.querySelector('.npc-dialogue-area').style.display = 'none';
                    alert('Question would be loaded here!');
                }, 1000);
            }
        }

        // Initialize mock game manager and NPC system
        const mockGameManager = new MockGameManager();
        
        // NPC System (simplified version for testing)
        class TestNPCSystem {
            constructor(gameManager) {
                this.gameManager = gameManager;
                this.currentNpc = null;
                this.isTyping = false;
                this.typingSpeed = 50;
                
                this.npcData = {
                    alex_ceo: {
                        name: "Alex",
                        title: "Ïä§ÌÉÄÌä∏ÏóÖ CEO",
                        avatar: "üëî",
                        greetings: [
                            "ÏïàÎÖïÌïòÏÑ∏Ïöî! Ï†ÄÎäî TechStartÏùò CEO AlexÏûÖÎãàÎã§.",
                            "Ïö∞Î¶¨ ÏÑúÎπÑÏä§Í∞Ä Í∞ëÏûêÍ∏∞ Ïù∏Í∏∞Î•º ÎÅåÎ©¥ÏÑú Í∏∞Ïà†Ï†ÅÏù∏ Î¨∏Ï†úÎì§Ïù¥ ÏÉùÍ≤ºÏñ¥Ïöî.",
                            "ÏãúÍ∞ÑÏù¥ Ï†ïÎßê Ï§ëÏöîÌï¥Ïöî! Îπ†Î•∏ Ìï¥Í≤∞Ï±ÖÏù¥ ÌïÑÏöîÌï¥Ïöî!"
                        ]
                    },
                    sarah_analyst: {
                        name: "Sarah",
                        title: "Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞Ä",
                        avatar: "üìä",
                        greetings: [
                            "ÏïàÎÖïÌïòÏÑ∏Ïöî, Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞Ä SarahÏûÖÎãàÎã§.",
                            "ÎåÄÏö©Îüâ Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨Ïóê Í¥ÄÎ†®Îêú AWS ÏÜîÎ£®ÏÖòÏóê ÎåÄÌï¥ Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏñ¥Ïöî.",
                            "Îß§Ïùº Ï≤òÎ¶¨Ìï¥Ïïº ÌïòÎäî Îç∞Ïù¥ÌÑ∞ÎüâÏù¥ Í≥ÑÏÜç Ï¶ùÍ∞ÄÌïòÍ≥† ÏûàÏñ¥ÏÑú ÎèÑÏõÄÏù¥ ÌïÑÏöîÌï¥Ïöî."
                        ]
                    },
                    mike_security: {
                        name: "Mike",
                        title: "Î≥¥Ïïà Îã¥ÎãπÏûê",
                        avatar: "üîí",
                        greetings: [
                            "Î≥¥Ïïà Îã¥ÎãπÏûê MikeÏûÖÎãàÎã§.",
                            "ÌÅ¥ÎùºÏö∞Îìú Î≥¥ÏïàÏùÑ Í∞ïÌôîÌïòÍ≥† Ïã∂ÏùÄÎç∞, AWSÏùò Î≥¥Ïïà ÏÑúÎπÑÏä§Îì§Ïóê ÎåÄÌï¥ Ï°∞Ïñ∏ÏùÑ Íµ¨ÌïòÍ≥† Ïã∂ÏäµÎãàÎã§.",
                            "Î≥¥ÏïàÏùÄ ÌÉÄÌòëÌï† Ïàò ÏóÜÎäî ÏòÅÏó≠Ïù¥ÎùºÍ≥† ÏÉùÍ∞ÅÌï©ÎãàÎã§."
                        ]
                    },
                    jenny_developer: {
                        name: "Jenny",
                        title: "ÌíÄÏä§ÌÉù Í∞úÎ∞úÏûê",
                        avatar: "üíª",
                        greetings: [
                            "Í∞úÎ∞úÏûê JennyÏûÖÎãàÎã§!",
                            "ÏÑúÎ≤ÑÎ¶¨Ïä§ ÏïÑÌÇ§ÌÖçÏ≤òÎ°ú Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÎßåÎì§Í≥† Ïã∂ÏùÄÎç∞, Ïñ¥Îñ§ AWS ÏÑúÎπÑÏä§Îì§ÏùÑ ÏÇ¨Ïö©Ìï¥Ïïº Ìï†ÏßÄ Í≥†ÎØºÏù¥ÏóêÏöî.",
                            "ÏÉàÎ°úÏö¥ Í∏∞Ïà†ÏùÑ Î∞∞Ïö∞Îäî Í±∏ Ï¢ãÏïÑÌï¥ÏÑú ÎèÑÏ†ÑÌï¥Î≥¥Í≥† Ïã∂Ïñ¥Ïöî!"
                        ]
                    }
                };
                
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                document.getElementById('continue-dialogue-btn').addEventListener('click', () => {
                    this.continueDialogue();
                });
                
                document.getElementById('skip-dialogue-btn').addEventListener('click', () => {
                    this.skipDialogue();
                });
            }
            
            async startNpcDialogue(npcId) {
                this.currentNpc = npcId;
                const npcData = this.npcData[npcId];
                
                if (!npcData) {
                    console.error('NPC data not found:', npcId);
                    return;
                }
                
                this.updateNpcDisplay(npcData);
                document.querySelector('.npc-dialogue-area').style.display = 'block';
                
                await this.showGreeting(npcData);
            }
            
            updateNpcDisplay(npcData) {
                const avatarElement = document.getElementById('current-npc-avatar');
                const nameElement = document.getElementById('current-npc-name');
                const titleElement = document.getElementById('current-npc-title');
                
                avatarElement.textContent = npcData.avatar;
                nameElement.textContent = npcData.name;
                titleElement.textContent = npcData.title;
            }
            
            async showGreeting(npcData) {
                const greetings = npcData.greetings;
                
                for (let i = 0; i < greetings.length; i++) {
                    await this.typeMessage(greetings[i]);
                    
                    if (i < greetings.length - 1) {
                        await this.waitForContinue();
                    }
                }
                
                // After greeting, simulate loading question
                setTimeout(() => {
                    this.gameManager.loadQuestion();
                }, 1000);
            }
            
            async typeMessage(message) {
                const dialogueText = document.getElementById('dialogue-text');
                const continueBtn = document.getElementById('continue-dialogue-btn');
                const skipBtn = document.getElementById('skip-dialogue-btn');
                
                this.isTyping = true;
                continueBtn.style.display = 'none';
                skipBtn.style.display = 'inline-block';
                
                dialogueText.textContent = '';
                
                for (let i = 0; i < message.length; i++) {
                    if (!this.isTyping) break;
                    
                    dialogueText.textContent += message[i];
                    await this.sleep(this.typingSpeed);
                }
                
                if (!this.isTyping) {
                    dialogueText.textContent = message;
                }
                
                this.isTyping = false;
                continueBtn.style.display = 'inline-block';
                skipBtn.style.display = 'none';
            }
            
            async waitForContinue() {
                return new Promise((resolve) => {
                    const continueBtn = document.getElementById('continue-dialogue-btn');
                    
                    const handleContinue = () => {
                        continueBtn.removeEventListener('click', handleContinue);
                        resolve();
                    };
                    
                    continueBtn.addEventListener('click', handleContinue);
                });
            }
            
            continueDialogue() {
                // This will be handled by the promise in waitForContinue
            }
            
            skipDialogue() {
                this.isTyping = false;
            }
            
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        const npcSystem = new TestNPCSystem(mockGameManager);
        
        function testNPC(npcId) {
            npcSystem.startNpcDialogue(npcId);
        }
    </script>
</body>
</html>
